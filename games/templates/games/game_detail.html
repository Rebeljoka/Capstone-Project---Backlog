{% extends 'base.html' %} {% load game_extras %} {% load static %} {% block content %}
<div class="mx-auto px-4 py-6 max-w-screen-2xl">
	{% if error %}
	<!-- Error State -->
	<div class="max-w-2xl mx-auto">
		<div class="alert alert-error mb-6">
			<iconify-icon icon="tabler:alert-circle"></iconify-icon>
			<span>{{ error }}</span>
		</div>
		<div class="text-center py-12">
			<iconify-icon icon="tabler:device-gamepad-off" class="text-6xl text-error/30 mb-4"></iconify-icon>
			<h3 class="text-xl font-semibold mb-2">Game Not Found</h3>
			<p class="text-base-content/70 mb-4">We couldn't load the details for this game from Steam.</p>
			<a href="{% url 'game_list' %}" class="btn btn-primary">
				<iconify-icon icon="tabler:arrow-left"></iconify-icon>
				Back to Games
			</a>
		</div>
	</div>
	{% else %}
	<!-- Game Detail Content -->
	<div class="max-w-6xl mx-auto">
		<!-- Breadcrumb Navigation -->
		<div class="breadcrumbs text-sm mb-6">
			<ul>
				<li><a href="{% url 'game_list' %}" class="text-primary hover:text-primary-focus">Games</a></li>
				<li class="text-base-content/70">{{ game.title|truncatechars:50 }}</li>
			</ul>
		</div>

		<!-- Main Game Info Section -->
		<div class="grid grid-cols-1 lg:grid-cols-3 gap-8 mb-8">
			<!-- Game Image -->
			<div class="lg:col-span-1">
				<div class="aspect-video bg-base-200 rounded-lg overflow-hidden shadow-lg mb-4">
					{% if game.image %}
					<img src="{{ game.image }}" alt="{{ game.title }}" class="w-full h-full object-cover" />
					{% else %}
					<div class="w-full h-full flex items-center justify-center">
						<iconify-icon icon="tabler:photo-off" class="text-4xl text-base-content/30"></iconify-icon>
					</div>
					{% endif %}
				</div>

				<!-- Platform Support -->
				{% if game.platforms %}
				<div class="card bg-base-100 shadow-sm mb-4">
					<div class="card-body p-4">
						<h3 class="font-semibold mb-2 flex items-center gap-2">
							<iconify-icon icon="tabler:device-gamepad"></iconify-icon>
							Platform Support
						</h3>
						<div class="flex gap-2">
							{% if game.platforms.windows %}
							<div class="badge badge-neutral gap-2">
								<iconify-icon icon="simple-icons:windows"></iconify-icon>
								Windows
							</div>
							{% endif %} {% if game.platforms.mac %}
							<div class="badge badge-neutral gap-2">
								<iconify-icon icon="simple-icons:apple"></iconify-icon>
								Mac
							</div>
							{% endif %} {% if game.platforms.linux %}
							<div class="badge badge-neutral gap-2">
								<iconify-icon icon="simple-icons:linux"></iconify-icon>
								Linux
							</div>
							{% endif %}
						</div>
					</div>
				</div>
				{% endif %}

				<!-- Action Buttons -->
				<div class="space-y-3">
					<a href="https://store.steampowered.com/app/{{ game.appid }}/" target="_blank" class="btn btn-primary w-full gap-2">
						<iconify-icon icon="simple-icons:steam"></iconify-icon>
						View on Steam
					</a>
					{% if user.is_authenticated %}
					<a href="{% url 'add_steam_game_to_wishlist' game.appid %}" class="btn btn-outline btn-secondary w-full gap-2">
						<iconify-icon icon="tabler:heart"></iconify-icon>
						Add to Wishlist
					</a>
					{% endif %}
					<a href="{% url 'game_list' %}" class="btn btn-outline btn-ghost w-full gap-2">
						<iconify-icon icon="tabler:arrow-left"></iconify-icon>
						Back to Games
					</a>
				</div>
			</div>

			<!-- Game Details -->
			<div class="lg:col-span-2">
				<!-- Title and Basic Info -->
				<div class="mb-6">
					<h1 class="text-4xl font-bold mb-4">{{ game.title }}</h1>

					<!-- Game Stats -->
					<div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-6">
						{% if game.developer %}
						<div class="stat bg-base-100 rounded-lg shadow-sm">
							<div class="stat-figure text-primary">
								<iconify-icon icon="tabler:users" class="text-2xl"></iconify-icon>
							</div>
							<div class="stat-title">Developer</div>
							<div class="stat-value text-base text-primary">{{ game.developer|truncatechars:20 }}</div>
						</div>
						{% endif %} {% if game.release_date %}
						<div class="stat bg-base-100 rounded-lg shadow-sm">
							<div class="stat-figure text-secondary">
								<iconify-icon icon="tabler:calendar" class="text-2xl"></iconify-icon>
							</div>
							<div class="stat-title">Release Date</div>
							<div class="stat-value text-base text-secondary">{{ game.release_date }}</div>
						</div>
						{% endif %} {% if game.price %}
						<div class="stat bg-base-100 rounded-lg shadow-sm">
							<div class="stat-figure text-accent">
								<iconify-icon icon="tabler:currency-dollar" class="text-2xl"></iconify-icon>
							</div>
							<div class="stat-title">Price</div>
							<div class="stat-value text-base text-accent">{{ game.price }}</div>
						</div>
						{% endif %}
					</div>
				</div>

				<!-- Description -->
				{% if game.description %}
				<div class="card bg-base-100 shadow-sm mb-6">
					<div class="card-body">
						<h2 class="card-title flex items-center gap-2 mb-4">
							<iconify-icon icon="tabler:file-text"></iconify-icon>
							Description
						</h2>
						<div class="prose max-w-none">
							<p class="text-base-content/80 leading-relaxed">{{ game.description|linebreaks }}</p>
						</div>
					</div>
				</div>
				{% elif game.short_description %}
				<div class="card bg-base-100 shadow-sm mb-6">
					<div class="card-body">
						<h2 class="card-title flex items-center gap-2 mb-4">
							<iconify-icon icon="tabler:file-text"></iconify-icon>
							Description
						</h2>
						<div class="prose max-w-none">
							<p class="text-base-content/80 leading-relaxed">{{ game.short_description|linebreaks }}</p>
						</div>
					</div>
				</div>
				{% endif %}

				<!-- Genres -->
				{% if game.genres %}
				<div class="card bg-base-100 shadow-sm mb-6">
					<div class="card-body">
						<h2 class="card-title flex items-center gap-2 mb-4">
							<iconify-icon icon="tabler:tag"></iconify-icon>
							Genres
						</h2>
						<div class="flex flex-wrap gap-2">
							{% for genre in game.genres %}
							<div class="badge badge-primary badge-lg">{{ genre.description }}</div>
							{% endfor %}
						</div>
					</div>
				</div>
				{% endif %}

				<!-- Tags -->
				{% if game.tags %}
				<div class="card bg-base-100 shadow-sm mb-6">
					<div class="card-body">
						<h2 class="card-title flex items-center gap-2 mb-4">
							<iconify-icon icon="tabler:tags"></iconify-icon>
							Categories
						</h2>
						<div class="flex flex-wrap gap-2">
							{% for tag in game.tags %}
							<div class="badge badge-secondary badge-lg">{{ tag.description }}</div>
							{% endfor %}
						</div>
					</div>
				</div>
				{% endif %}

				<!-- System Requirements (if available) -->
				{% if game.pc_requirements_minimum or game.mac_requirements_minimum or game.linux_requirements_minimum or game.pc_requirements or game.mac_requirements or game.linux_requirements %}
				<div class="card bg-base-100 shadow-sm mb-6">
					<div class="card-body">
						<h2 class="card-title flex items-center gap-2 mb-4">
							<iconify-icon icon="tabler:cpu"></iconify-icon>
							System Requirements
						</h2>

						<div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
							{% if game.pc_requirements_minimum %}
							<div>
								<h3 class="font-semibold flex items-center gap-2 mb-2">
									<iconify-icon icon="simple-icons:windows"></iconify-icon>
									Windows
								</h3>
								<div class="text-sm text-base-content/70 bg-base-200 rounded p-3 overflow-auto whitespace-pre-line" style="max-height: 200px;">
									{# Render HTML for PC requirements (Steam API returns HTML) #}
									{% if '<' in game.pc_requirements_minimum %}
										{{ game.pc_requirements_minimum|safe }}
									{% else %}
										{{ game.pc_requirements_minimum|addbrcommas|safe }}
									{% endif %}
								</div>
							</div>
							{% endif %}
							{% if game.mac_requirements_minimum %}
							<div>
								<h3 class="font-semibold flex items-center gap-2 mb-2">
									<iconify-icon icon="simple-icons:apple"></iconify-icon>
									Mac
								</h3>
								<div class="text-sm text-base-content/70 bg-base-200 rounded p-3 overflow-auto whitespace-pre-line" style="max-height: 200px;">
									{{ game.mac_requirements_minimum|addbrcommas|safe|default:"Not specified" }}
								</div>
							</div>
							{% endif %}
							{% if game.linux_requirements_minimum %}
							<div>
								<h3 class="font-semibold flex items-center gap-2 mb-2">
									<iconify-icon icon="simple-icons:linux"></iconify-icon>
									Linux
								</h3>
								<div class="text-sm text-base-content/70 bg-base-200 rounded p-3 overflow-auto whitespace-pre-line" style="max-height: 200px;">
									{{ game.linux_requirements_minimum|addbrcommas|safe|default:"Not specified" }}
								</div>
							</div>
							{% endif %}
						</div>
					</div>
				</div>
				{% endif %}
			</div>
		</div>

		<!-- Additional Information -->
		{% if game.screenshots or game.movies %}
		<div class="card bg-base-100 shadow-sm mb-6">
			<div class="card-body">
				<h2 class="card-title flex items-center gap-2 mb-4">
					<iconify-icon icon="tabler:photo"></iconify-icon>
					Media
				</h2>

				<!-- Screenshots -->
				{% if game.screenshots %}
				<div class="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-4">
					{% for screenshot in game.screenshots|slice:":8" %}
					<div class="aspect-video bg-base-200 rounded-lg overflow-hidden">
						<img src="{{ screenshot.path_thumbnail }}" alt="Screenshot" class="w-full h-full object-cover hover:scale-105 transition-transform cursor-pointer" onclick="window.open('{{ screenshot.path_full }}', '_blank')" />
					</div>
					{% endfor %}
				</div>
				{% endif %}
			</div>
		</div>
		{% endif %}
	</div>
	{% endif %}
</div>
{% endblock %}
