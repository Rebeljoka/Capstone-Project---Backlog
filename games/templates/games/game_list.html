{% extends 'base.html' %}
{% block content %}
<div class="container mx-auto px-4 py-6">
  <div class="mb-6">
    <h1 class="text-3xl font-bold text-gray-800 mb-2">Steam Games</h1>
    <p class="text-gray-600">Quick browse view - click "View Details" for full game information</p>
  </div>

  {% if steam_error %}
    <div class="bg-red-100 text-red-800 p-4 rounded mb-4">{{ steam_error }}</div>
  {% endif %}
<form method="get" class="mb-4 flex flex-wrap gap-4 items-center">
  <input type="text" name="search" value="{{ search_query }}" placeholder="Search games..." class="border rounded px-2 py-1" />
  <label for="genre">Genre:</label>
  <select name="genre" id="genre" onchange="this.form.submit()" class="border rounded px-2 py-1">
    <option value="">All</option>
    {% for genre_id, genre_name in genres %}
      <option value="{{ genre_id }}" {% if genre_id|stringformat:'s' == selected_genre %}selected{% endif %}>{{ genre_name }}</option>
    {% endfor %}
  </select>
  <label for="tag">Tag:</label>
  <select name="tag" id="tag" onchange="this.form.submit()" class="border rounded px-2 py-1">
    <option value="">All</option>
    {% for tag_id, tag_name in tags %}
      <option value="{{ tag_id }}" {% if tag_id|stringformat:'s' == selected_tag %}selected{% endif %}>{{ tag_name }}</option>
    {% endfor %}
  </select>
  <button type="submit" class="bg-blue-500 text-white px-4 py-1 rounded">Filter</button>
</form>
<section class="steam-game-list grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-4">
  {% for game in steam_games %}
    <div class="game-card bg-white border border-gray-200 rounded-lg overflow-hidden hover:shadow-md transition-shadow">
      <!-- Game Image -->
      <div class="relative">
        {% if game.image %}
          <img src="{{ game.image }}" alt="{{ game.title }} header" class="w-full h-48 object-cover">
        {% else %}
          <div class="w-full h-48 bg-gray-200 flex items-center justify-center">
            <span class="text-gray-400 text-sm">No Image</span>
          </div>
        {% endif %}
        
        <!-- Platform Icons Overlay -->
        <div class="absolute top-2 right-2 flex gap-1">
          {% if game.platforms.windows %}
            <span class="text-xs bg-black bg-opacity-70 text-white px-2 py-1 rounded" title="Windows">üñ•Ô∏è</span>
          {% endif %}
          {% if game.platforms.mac %}
            <span class="text-xs bg-black bg-opacity-70 text-white px-2 py-1 rounded" title="Mac">üçé</span>
          {% endif %}
          {% if game.platforms.linux %}
            <span class="text-xs bg-black bg-opacity-70 text-white px-2 py-1 rounded" title="Linux">üêß</span>
          {% endif %}
        </div>
      </div>
      
      <!-- Game Info -->
      <div class="p-4">
        <h2 class="text-lg font-bold mb-2 leading-tight">
          <a href="{% url 'game_detail' game.appid %}" class="text-blue-600 hover:text-blue-800 underline">
            {{ game.title }}
          </a>
        </h2>
        
        <!-- Genres (max 2) -->
        <div class="mb-2">
          <span class="text-sm font-semibold text-gray-600">Genres:</span>
          {% for genre in game.genres|slice:":2" %}
            <span class="inline-block bg-blue-100 text-blue-800 text-xs px-2 py-1 rounded mr-1">
              {{ genre.description|default:genre }}
            </span>
          {% empty %}
            <span class="text-xs text-gray-400">Unknown</span>
          {% endfor %}
        </div>
        
        <!-- Tags (max 2) -->
        <div class="mb-3">
          <span class="text-sm font-semibold text-gray-600">Tags:</span>
          {% for tag in game.tags|slice:":2" %}
            <span class="inline-block bg-green-100 text-green-800 text-xs px-2 py-1 rounded mr-1">
              {{ tag.description|default:tag }}
            </span>
          {% empty %}
            <span class="text-xs text-gray-400">None</span>
          {% endfor %}
        </div>
        
        <!-- Action buttons -->
        <div class="flex gap-2">
          <a href="{% url 'game_detail' game.appid %}" 
             class="flex-1 text-center bg-blue-500 hover:bg-blue-600 text-white px-3 py-2 rounded text-sm font-medium transition-colors">
            View Details
          </a>
          {% if user.is_authenticated %}
            <a href="{% url 'add_steam_game_to_wishlist' game.appid %}" 
               class="bg-green-500 hover:bg-green-600 text-white px-3 py-2 rounded text-sm font-medium transition-colors">
              + Wishlist
            </a>
          {% endif %}
        </div>
      </div>
    </div>
  {% empty %}
    <div class="text-center py-8 text-gray-500">
      <p>No Steam games found.</p>
      {% if search_query %}
        <p class="text-sm mt-2">Try adjusting your search terms.</p>
      {% endif %}
    </div>
  {% endfor %}
</section>
<div class="flex justify-center mt-6">
  <div class="join">
    <!-- Previous Button -->
    {% if page_obj.has_previous %}
      <a href="?{% if search_query %}search={{ search_query }}&{% endif %}{% if selected_genre %}genre={{ selected_genre }}&{% endif %}{% if selected_tag %}tag={{ selected_tag }}&{% endif %}page={{ page_obj.previous_page_number }}" class="join-item btn">¬´</a>
    {% else %}
      <button class="join-item btn btn-disabled">¬´</button>
    {% endif %}

    <!-- Page Numbers -->
    {% with page_obj.paginator.num_pages as total_pages %}
      {% with page_obj.number as current_page %}
        
        <!-- First page -->
        {% if current_page > 3 %}
          <a href="?{% if search_query %}search={{ search_query }}&{% endif %}{% if selected_genre %}genre={{ selected_genre }}&{% endif %}{% if selected_tag %}tag={{ selected_tag }}&{% endif %}page=1" class="join-item btn">1</a>
          {% if current_page > 4 %}
            <button class="join-item btn btn-disabled">...</button>
          {% endif %}
        {% endif %}

        <!-- Page numbers around current page -->
        {% for page_num in page_obj.paginator.page_range %}
          {% if page_num >= current_page|add:"-2" and page_num <= current_page|add:"2" %}
            {% if page_num == current_page %}
              <button class="join-item btn btn-active">{{ page_num }}</button>
            {% else %}
              <a href="?{% if search_query %}search={{ search_query }}&{% endif %}{% if selected_genre %}genre={{ selected_genre }}&{% endif %}{% if selected_tag %}tag={{ selected_tag }}&{% endif %}page={{ page_num }}" class="join-item btn">{{ page_num }}</a>
            {% endif %}
          {% endif %}
        {% endfor %}

        <!-- Last page -->
        {% if current_page < total_pages|add:"-2" %}
          {% if current_page < total_pages|add:"-3" %}
            <button class="join-item btn btn-disabled">...</button>
          {% endif %}
          <a href="?{% if search_query %}search={{ search_query }}&{% endif %}{% if selected_genre %}genre={{ selected_genre }}&{% endif %}{% if selected_tag %}tag={{ selected_tag }}&{% endif %}page={{ total_pages }}" class="join-item btn">{{ total_pages }}</a>
        {% endif %}

      {% endwith %}
    {% endwith %}

    <!-- Next Button -->
    {% if page_obj.has_next %}
      <a href="?{% if search_query %}search={{ search_query }}&{% endif %}{% if selected_genre %}genre={{ selected_genre }}&{% endif %}{% if selected_tag %}tag={{ selected_tag }}&{% endif %}page={{ page_obj.next_page_number }}" class="join-item btn">¬ª</a>
    {% else %}
      <button class="join-item btn btn-disabled">¬ª</button>
    {% endif %}
  </div>
</div>
</div>
{% endblock %}