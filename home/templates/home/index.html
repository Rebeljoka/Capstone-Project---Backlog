{% extends 'base.html' %} {% load static %} {% block content %}
<section class="text-center hero-section overflow-hidden">
	<!-- Hero image: keep eager load for LCP but hint priority and reserve aspect ratio to avoid CLS -->
	<img src="{% static 'images/hero.webp' %}" alt="Logo" id="hero-img" class="mx-auto blur-md scale-105 bg-center hero-img" />
	<div class="grid place-items-center absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2">
		<h1 class="text-4xl md:text-5xl font-bold text-white mb-4">Welcome to Backlog.</h1>
		<h2 class="text-xl md:text-2xl text-white mb-6">Organize your gaming journey.</h2>
		<h3 class="text-md md:text-lg text-white mb-6">Track your game collection, create custom wishlists, and discover new games.</h3>
		<h4 class="text-md md:text-lg text-white mb-6">Browse our extensive library of games today and Sign up!</h4>
		<div class="flex flex-row justify-center gap-4 mt-2">
			<a href="{% url 'account_signup' %}" class="px-6 py-3 bg-green-900 hover:bg-green-700 text-white rounded-lg text-lg font-medium transition-colors shadow-md hover:shadow-lg">Sign Up</a>
			<a href="{% url 'game_list' %}" class="px-6 py-3 text-white rounded-lg text-lg font-medium shadow-md hover:shadow-lg rainbow-btn">Get Started</a>
		</div>
	</div>
</section>

<!-- Popular Wishlisted Games -->
<section class="w-full py-12 mb-12 mt-12">
	<div class="mb-8 mt-8">
		<h1 class="text-4xl md:text-4xl lg:text-5xl font-bold text-center">Popular Wishlisted Games</h1>
	</div>

	<div class="popular-grid w-[75vw] mx-auto px-6">
		{% for game in popular_games|slice:":5" %}
		<div class="popular-card flex flex-col h-full rounded-xl shadow-lg gap-y-4" style="background-color: var(--color-card-bg)">
			<a href="{% url 'game_detail' game.game_id %}" class="block overflow-hidden rounded-t-xl">
				<div class="relative">
					{% if game.image %}
					<img class="w-full h-48 object-cover" src="{{ game.image }}" alt="{{ game.title }} cover" />
					{% else %}
					<img class="w-full h-48 object-cover" src="{% static 'images/placeholder.png' %}" alt="placeholder cover" />
					{% endif %}
					<span class="absolute top-2 right-2 badge badge-primary badge-lg">POPULAR</span>
				</div>
			</a>
			<div class="flex flex-col flex-1 px-6 py-5 gap-4">
				<div class="w-full max-w-full">
					<a href="{% url 'game_detail' game.game_id %}">
						<h2 class="text-2xl font-semibold tracking-tight text-gray-900 dark:text-white text-center leading-snug overflow-hidden text-ellipsis whitespace-nowrap">{{ game.title }}</h2>
					</a>
				</div>
				<div class="flex items-center justify-center gap-2 text-xl font-semibold">
					<span class="nf nf-oct-heart text-red-500 text-3xl"></span>
					<span>{{ game.wishlist_count|default:0 }}</span>
				</div>
				<div class="mt-auto flex flex-col gap-3 pt-2 pb-4">
					<a href="{% url 'game_detail' game.game_id %}" class="w-full text-center text-white bg-green-900 hover:bg-green-700 focus:ring-4 focus:outline-none focus:ring-green-300 font-medium rounded-lg text-lg py-2 whitespace-normal">View details</a>
					{% if user.is_authenticated %}
					<a href="{% url 'add_steam_game_to_wishlist' game.game_id %}" class="w-full text-center btn btn-outline btn-secondary btn-md text-lg whitespace-normal">Add to Wishlist!</a>
					{% endif %}
				</div>
			</div>
		</div>
		{% empty %}
		<p class="text-center text-lg text-gray-500">No popular games yet — add some to your wishlist to see them here!</p>
		{% endfor %}
	</div>
</section>

<section class="w-full py-16">
	<div class="w-[90vw] max-w-7xl mx-auto px-6">
		<!-- Header -->
		<div class="text-center mb-12">
			<h1 class="text-4xl lg:text-5xl font-bold mb-6">Community Insights</h1>
			<p class="text-lg md:text-xl text-gray-600 dark:text-gray-300 max-w-3xl mx-auto">Explore how players are building their libraries — from wishlist surges to rising engagement. These charts show what’s catching attention across the community.</p>
		</div>

		<!-- Grid of Panels -->
		<div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6 @container">
			<!-- 1️⃣ Users vs Visitors — large only -->
			<div class="hidden lg:flex flex-col items-center w-full rounded-lg p-6 shadow-sm">
				<h2 class="text-2xl font-semibold mb-4 w-full flex justify-center">Users vs Visitors</h2>
				<div class="w-full flex justify-center mb-4">
					{% if traffic_chart_div %} {{ traffic_chart_div|safe }} {% else %}
					<p class="text-center text-gray-500">Analytics data coming soon.</p>
					{% endif %}
				</div>
				<ul class="space-y-2 text-center text-base md:text-lg">
					<li><span class="font-semibold">Registered users:</span> {{ traffic_summary.total_users }}</li>
					<li><span class="font-semibold">New in last 7 days:</span> {{ traffic_summary.new_users_last_week }}</li>
					<li><span class="font-semibold">Visitors (7 days):</span> {{ traffic_summary.visitors_last_week }}</li>
					<li><span class="font-semibold">Visitors (all-time):</span> {{ traffic_summary.visitors_all_time }}</li>
				</ul>
			</div>

			<!-- 2️⃣ Wishlist Engagement — always visible -->
			<div class="rounded-lg p-6">
				<h2 class="text-2xl font-semibold mb-4 w-full flex justify-center">Wishlist Engagement</h2>
				<div class="w-full flex justify-center mb-4">
					{% if engagement_chart_div %} {{ engagement_chart_div|safe }} {% else %}
					<p class="text-center text-gray-500">Engagement metrics will appear once users start building wishlists.</p>
					{% endif %}
				</div>
				<ul class="space-y-2 text-center text-base md:text-lg">
					<li><span class="font-semibold">Avg wishlists per user:</span> {{ engagement_summary.average_wishlists|floatformat:1 }}</li>
					<li><span class="font-semibold">Users with wishlists:</span> {{ engagement_summary.users_with_wishlist }}</li>
					<li><span class="font-semibold">Adoption rate:</span> {{ engagement_summary.adoption_percent|floatformat:1 }}%</li>
					<li><span class="font-semibold">Extra wishlists:</span> {{ engagement_summary.additional_wishlists }}</li>
				</ul>
			</div>

			<!-- 3️⃣ Wishlist Velocity — tablet and up -->
			<div class="hidden md:block rounded-lg p-6">
				<h2 class="text-2xl font-semibold mb-4 w-full flex justify-center">Wishlist Velocity</h2>
				<div class="w-full flex justify-center mb-4">
					{% if wishlist_chart_div %} {{ wishlist_chart_div|safe }} {% else %}
					<p class="text-center text-gray-500">No wishlist activity recorded yet.</p>
					{% endif %}
				</div>
				<ul class="space-y-2 text-center text-base md:text-lg">
					<li><span class="font-semibold">Total wishlists:</span> {{ wishlist_summary.total_wishlists }}</li>
					<li><span class="font-semibold">Created today:</span> {{ wishlist_summary.created_today }}</li>
					<li><span class="font-semibold">Created last 7 days:</span> {{ wishlist_summary.created_last_week }}</li>
					<li><span class="font-semibold">Created last 30 days:</span> {{ wishlist_summary.created_last_month }}</li>
				</ul>
			</div>
		</div>
	</div>
</section>

<section class="text-center overflow-hidden form-section">
	<!-- Decorative form background: lazy-load to defer large image bytes until needed -->
	<img src="{% static 'images/form-bg.webp' %}" alt="formbg" class="w-full mx-auto blur-md bg-center form-bg" loading="lazy" decoding="async" />
</section>

{% if bokeh_css %} {% for css_url in bokeh_css %}
<link rel="stylesheet" href="{{ css_url }}" />
{% endfor %} {% endif %} {% if bokeh_js %} {% for js_url in bokeh_js %}
<script src="{{ js_url }}"></script>
{% endfor %} {% endif %} {% if chart_script %} {{ chart_script|safe }} {% endif %}

<!-- JS shim: enforce visibility for debug panels by viewport width. Remove when Tailwind/responsive CSS is fixed. -->
<script>
	document.addEventListener("DOMContentLoaded", function () {
		function applyPanelVisibility() {
			document.querySelectorAll("[data-show-min]").forEach(function (el) {
				var min = parseInt(el.getAttribute("data-show-min"), 10) || 0;
				if (window.innerWidth >= min) {
					el.style.display = "block";
				} else {
					el.style.display = "none";
				}
			});
		}

		// initial
		applyPanelVisibility();
		// update on resize (debounced)
		var to;
		window.addEventListener("resize", function () {
			clearTimeout(to);
			to = setTimeout(applyPanelVisibility, 120);
		});
	});
</script>

<script>
	window.addEventListener("scroll", function () {
		const img = document.getElementById("hero-img");
		const scrolled = window.scrollY;
		img.style.transform = `translateY(${scrolled * 0.3}px) scale(1.05)`; // 0.3 = parallax speed
	});
</script>
{% endblock %}
