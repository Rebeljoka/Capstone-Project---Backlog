{% extends "base.html" %}
{% load static %}
{% load profile_extras %}

{% block content %}
<div class="min-h-screen">
    <div class="container mx-auto px-4 py-8">
        <!-- Profile Header -->
        <div class="bg-base-100 rounded-2xl shadow-xl border border-base-300 mb-8">
            <div class="card-body p-8">
                <div class="flex flex-col lg:flex-row items-center lg:items-start gap-6">
                    <!-- Avatar -->
                    <div class="avatar">
                        <div class="w-32 h-32 rounded-full ring ring-primary ring-offset-base-100 ring-offset-2">
                            <img src="{{ user|profile_picture_url }}" alt="Profile Avatar" onerror="this.src='https://ui-avatars.com/api/?name={{ user|user_initials }}&background=667eea&color=ffffff&size=200&bold=true'" />
                        </div>
                    </div>
                    
                    <!-- User Info -->
                    <div class="flex-1 text-center lg:text-left">
                        <h1 class="text-4xl font-bold text-base-content mb-2">{{ user.username|default:"User" }}</h1>
                        <p class="text-xl text-base-content/70 mb-4">{{ user.email|default:"member@backlog.com" }}</p>
                        
                        <!-- User Stats -->
                        <div class="flex flex-row justify-center lg:justify-start gap-4 mb-6 pt-4">
                            <div class="stat bg-primary/10 rounded-lg p-4 text-center min-w-0 flex-1 lg:flex-initial lg:min-w-[120px]">
                                <div class="stat-value text-primary text-2xl">{{ stats.wishlists|default:0 }}</div>
                                <div class="stat-title text-sm">Wishlists</div>
                            </div>
                            <div class="stat bg-secondary/10 rounded-lg p-4 text-center min-w-0 flex-1 lg:flex-initial lg:min-w-[120px]">
                                <div class="stat-value text-secondary text-2xl">{{ total_games|default:0 }}</div>
                                <div class="stat-title text-sm">Games Added</div>
                            </div>
                            <div class="stat bg-accent/10 rounded-lg p-4 text-center min-w-0 flex-1 lg:flex-initial lg:min-w-[120px]">
                                <div class="stat-value text-accent text-2xl">{{ days_joined|default:0 }}</div>
                                <div class="stat-title text-sm">Days Active</div>
                            </div>
                        </div>
                        
                        <!-- Action Buttons -->
                        <div class="flex flex-wrap justify-center lg:justify-start gap-3">
                            <a href="{% url 'edit_profile' %}" class="btn btn-primary">
                                <iconify-icon icon="tabler:edit"></iconify-icon>
                                Edit Profile
                            </a>
                            <a href="{% url 'wishlist_list' %}" class="btn btn-outline">
                                <iconify-icon icon="tabler:heart"></iconify-icon>
                                My Wishlists
                            </a>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
            <!-- Left Column - Profile Info -->
            <div class="lg:col-span-1 space-y-6">
                <!-- About Section -->
                <div class="card bg-base-100 shadow-xl border border-base-300">
                    <div class="card-body">
                        <h2 class="card-title flex items-center gap-2">
                            <iconify-icon icon="tabler:user" class="text-primary"></iconify-icon>
                            About
                        </h2>
                        <div class="space-y-3">
                            <div class="flex items-center gap-3">
                                <iconify-icon icon="tabler:calendar" class="text-base-content/60"></iconify-icon>
                                <span class="text-sm">
                                    Joined {{ user.date_joined|date:"F Y"|default:"Recently" }}
                                </span>
                            </div>
                            <div class="flex items-center gap-3">
                                <iconify-icon icon="tabler:clock" class="text-base-content/60"></iconify-icon>
                                <span class="text-sm">
                                    Last seen {{ user.last_login|date:"M d, Y"|default:"Today" }}
                                </span>
                            </div>
                            <div class="flex items-center gap-3">
                                <iconify-icon icon="tabler:device-gamepad" class="text-base-content/60"></iconify-icon>
                                <span class="text-sm">
                                    Gaming Enthusiast
                                </span>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Favorite Genres -->
                <div class="card bg-base-100 shadow-xl border border-base-300">
                    <div class="card-body">
                        <h2 class="card-title flex items-center gap-2">
                            <iconify-icon icon="tabler:star" class="text-primary"></iconify-icon>
                            Favorite Genres
                        </h2>
                        <div class="flex flex-wrap gap-2">
                            {% if favorite_genres %}
                                {% for genre in favorite_genres %}
                                    <div class="badge badge-primary">{{ genre }}</div>
                                {% endfor %}
                            {% else %}
                                <div class="badge badge-outline">No genres set</div>
                            {% endif %}
                        </div>
                    </div>
                </div>

                <!-- Gaming Platforms -->
                <div class="card bg-base-100 shadow-xl border border-base-300">
                    <div class="card-body">
                        <h2 class="card-title flex items-center gap-2">
                            <iconify-icon icon="tabler:device-desktop" class="text-primary"></iconify-icon>
                            Gaming Platforms
                        </h2>
                        <div class="space-y-2">
                            {% if platforms %}
                                {% for platform in platforms %}
                                    <div class="flex items-center justify-between">
                                        <span class="text-sm flex items-center gap-2">
                                            <iconify-icon icon="tabler:{{ platform.icon }}"></iconify-icon>
                                            {{ platform.name }}
                                        </span>
                                        <div class="badge badge-{% if platform.active %}success{% else %}outline{% endif %} badge-sm">{% if platform.active %}Active{% else %}Inactive{% endif %}</div>
                                    </div>
                                {% endfor %}
                            {% else %}
                                <div class="text-sm text-base-content/60">No platforms set</div>
                            {% endif %}
                        </div>
                    </div>
                </div>
            </div>

            <!-- Right Column - Activity & Wishlists -->
            <div class="lg:col-span-2 space-y-6">
                <!-- Recent Wishlists -->
                <div class="card bg-base-100 shadow-xl border border-base-300">
                    <div class="card-body">
                        <div class="flex items-center justify-between mb-4">
                            <h2 class="card-title flex items-center gap-2">
                                <iconify-icon icon="tabler:heart" class="text-primary"></iconify-icon>
                                Recent Wishlists
                            </h2>
                            <a href="{% url 'wishlist_list' %}" class="btn btn-sm btn-outline">View All</a>
                        </div>
                        
                        {% if recent_wishlists.count > 0 %}
                            <div class="space-y-3">
                                {% for wishlist in recent_wishlists|slice:"0:3" %}
                                    <div class="border border-base-300 rounded-lg p-4 hover:bg-base-200/50 transition-colors">
                                        <div class="flex items-center justify-between">
                                            <div>
                                                <h3 class="font-semibold">{{ wishlist.name }}</h3>
                                                <p class="text-sm text-base-content/60">
                                                    {{ wishlist.games.count }} game{{ wishlist.games.count|pluralize }}
                                                </p>
                                            </div>
                                            <div class="text-right">
                                                <div class="text-sm text-base-content/60">
                                                    Updated {{ wishlist.updated_at|date:"M d" }}
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                {% endfor %}
                            </div>
                        {% else %}
                            <div class="text-center py-8">
                                <iconify-icon icon="tabler:heart-broken" class="text-4xl text-base-content/30 mb-2"></iconify-icon>
                                <p class="text-base-content/60 mb-4">No wishlists yet</p>
                                <a href="{% url 'wishlist_list' %}" class="btn btn-primary btn-sm">Create Your First Wishlist</a>
                            </div>
                        {% endif %}
                    </div>
                </div>

                <!-- Activity Feed -->
                <div class="card bg-base-100 shadow-xl border border-base-300">
                    <div class="card-body">
                        <h2 class="card-title flex items-center gap-2">
                            <iconify-icon icon="tabler:activity" class="text-primary"></iconify-icon>
                            Recent Activity
                        </h2>
                        
                        <div class="space-y-4">
                            {% if activity_log %}
                                {% for activity in activity_log %}
                                    <div class="flex items-start gap-3">
                                        <div class="avatar placeholder">
                                            <div class="bg-primary text-primary-content w-8 h-8 rounded-full">
                                                <iconify-icon icon="tabler:{{ activity.icon }}" class="text-sm"></iconify-icon>
                                            </div>
                                        </div>
                                        <div class="flex-1">
                                            <p class="text-sm">{{ activity.text|safe }}</p>
                                            <p class="text-xs text-base-content/60">{{ activity.time }}</p>
                                        </div>
                                    </div>
                                {% endfor %}
                            {% else %}
                                <div class="text-base-content/60 text-sm">No recent activity</div>
                            {% endif %}
                        </div>
                    </div>
                </div>

                <!-- Gaming Stats -->
                <div class="card bg-base-100 shadow-xl border border-base-300">
                    <div class="card-body">
                        <h2 class="card-title flex items-center gap-2">
                            <iconify-icon icon="tabler:chart-bar" class="text-primary"></iconify-icon>
                            Gaming Statistics
                        </h2>
                        
                        <div class="grid grid-cols-2 md:grid-cols-4 gap-4">
                            <div class="text-center">
                                <div class="text-2xl font-bold text-primary">{{ stats.games_owned|default:0 }}</div>
                                <div class="text-xs text-base-content/60">Games Owned</div>
                            </div>
                            <div class="text-center">
                                <div class="text-2xl font-bold text-secondary">{{ stats.hours_played|default:0 }}</div>
                                <div class="text-xs text-base-content/60">Hours Played</div>
                            </div>
                            <div class="text-center">
                                <div class="text-2xl font-bold text-accent">{{ stats.completed|default:0 }}</div>
                                <div class="text-xs text-base-content/60">Completed</div>
                            </div>
                            <div class="text-center">
                                <div class="text-2xl font-bold text-info">{{ stats.in_backlog|default:0 }}</div>
                                <div class="text-xs text-base-content/60">In Backlog</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}